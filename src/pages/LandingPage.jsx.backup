import { useState, useEffect } from 'react';
import { motion } from 'framer-motion';
import Button from '../components/Button';
import Card from '../components/Card';
import { Link } from 'react-router-dom';
import { getStats } from '../services/statsService';
import { db } from '../firebase/config';
import { collection, query, where, getDocs, limit } from 'firebase/firestore';
import { Code, BookOpen, Users, Award, Briefcase, Headphones, ChevronLeft, ChevronRight, UserCircle, GraduationCap, Target } from 'lucide-react';

const LandingPage = () => {
    const [stats, setStats] = useState({
        studentCount: 50,
        reviewCount: 70,
        averageRating: 4.9
    });
    const [loadingStats, setLoadingStats] = useState(true);
    const [courses, setCourses] = useState([]);
    const [currentCourseIndex, setCurrentCourseIndex] = useState(0);
    const [isDragging, setIsDragging] = useState(false);
    const [startX, setStartX] = useState(0);
    const [scrollLeft, setScrollLeft] = useState(0);
    const [instructors, setInstructors] = useState([]);

    useEffect(() => {
        const fetchStats = async () => {
            try {
                const data = await getStats();
                setStats(data);
            } catch (error) {
                console.error('Error loading stats:', error);
            } finally {
                setLoadingStats(false);
            }
        };
        fetchStats();

        const fetchCourses = async () => {
            try {
                const q = query(collection(db, 'courses'), where('active', '==', true), limit(6));
                const snapshot = await getDocs(q);
                setCourses(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
            } catch (error) {
                console.error('Error loading courses:', error);
            }
        };
        fetchCourses();

        const fetchInstructors = async () => {
            try {
                const snapshot = await getDocs(collection(db, 'instructors'));
                setInstructors(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
            } catch (error) {
                console.error('Error loading instructors:', error);
            }
        };
        fetchInstructors();
    }, []);

    // Auto-scroll carousel
    useEffect(() => {
        if (courses.length <= 3 || isDragging) return;

        const interval = setInterval(() => {
            setCurrentCourseIndex((prev) => {
                const maxIndex = courses.length - 3;
                return prev >= maxIndex ? 0 : prev + 1;
            });
        }, 3000);

        return () => clearInterval(interval);
    }, [courses.length, isDragging]);

    const nextCourse = () => {
        const maxIndex = courses.length - 3;
        setCurrentCourseIndex((prev) => prev >= maxIndex ? 0 : prev + 1);
    };

    const prevCourse = () => {
        const maxIndex = courses.length - 3;
        setCurrentCourseIndex((prev) => prev <= 0 ? maxIndex : prev - 1);
    };

    // Drag handlers
    const handleDragStart = (e) => {
        setIsDragging(true);
        setStartX(e.type.includes('mouse') ? e.pageX : e.touches[0].pageX);
        setScrollLeft(currentCourseIndex);
    };

    const handleDragMove = (e) => {
        if (!isDragging) return;
        e.preventDefault();
        const x = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
        const walk = (startX - x) / 300; // Adjust sensitivity
        const maxIndex = courses.length - 3;
        const newIndex = Math.max(0, Math.min(maxIndex, Math.round(scrollLeft + walk)));
        setCurrentCourseIndex(newIndex);
        animate = {{ opacity: 1, y: 0 }
    }
    transition = {{ duration: 0.8 }
}
                >
    {/* Badge */ }
    < motion.div
initial = {{ opacity: 0, scale: 0.9 }}
animate = {{ opacity: 1, scale: 1 }}
transition = {{ duration: 0.5, delay: 0.2 }}
style = {{
    display: 'inline-flex',
        alignItems: 'center',
            gap: '0.5rem',
                padding: '0.5rem 1.25rem',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        border: '1px solid rgba(59, 130, 246, 0.3)',
                            borderRadius: '50px',
                                marginBottom: '1.5rem',
                                    fontSize: '0.875rem',
                                        fontWeight: '500',
                                            color: 'var(--color-primary)',
                                                backdropFilter: 'blur(10px)'
}}
                    >
    <span style={{ fontSize: '1.125rem' }}>ðŸš€</span>
                        Start Your Coding Journey
                    </motion.div >

                    <h1 style={{
                        fontSize: 'clamp(2.5rem, 5vw, 3.5rem)',
                        fontWeight: '800',
                        marginBottom: '1rem',
                        lineHeight: 1.2,
                        color: 'var(--color-text)'
                    }}>
                        Learn Programming<br />
                        with <span className="title-gradient">ZxSchool</span>
                    </h1>
                    <p style={{
                        fontSize: 'clamp(1rem, 2vw, 1.25rem)',
                        color: 'var(--color-text-secondary)',
                        maxWidth: '600px',
                        margin: '0 auto',
                        lineHeight: 1.6
                    }}>
                        Master coding from scratch with our interactive courses, real-world projects, and expert mentorship. Build your future in tech today.
                    </p>
                </motion.div >

    <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.2 }}
        style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap', justifyContent: 'center' }}
    >
        <Link to="/courses">
            <Button variant="primary" style={{ padding: '0.875rem 2rem', fontSize: '1.0625rem' }}>
                Start Learning
            </Button>
        </Link>
        <Link to="/signup">
            <Button variant="outline" style={{ padding: '0.875rem 2rem', fontSize: '1.0625rem' }}>
                Join Now
            </Button>
        </Link>
    </motion.div>

{/* Statistics */ }
<motion.div
    initial={{ opacity: 0, y: 40 }}
    whileInView={{ opacity: 1, y: 0 }}
    viewport={{ once: true, margin: "-100px" }}
    transition={{ duration: 0.8, ease: "easeOut" }}
    style={{
        display: 'flex',
        gap: '3rem',
        flexWrap: 'wrap',
        justifyContent: 'center',
        marginTop: '2rem'
    }}
>
    <div style={{ textAlign: 'center' }}>
        <div style={{
            fontSize: 'clamp(2rem, 4vw, 2.5rem)',
            fontWeight: '800',
            color: 'var(--color-primary)',
            marginBottom: '0.25rem'
        }}>
            {stats.studentCount}+
        </div>
        <div style={{
            fontSize: '0.875rem',
            color: 'var(--color-text-secondary)',
            fontWeight: '500'
        }}>
            Students
        </div>
    </div>

    <div style={{ textAlign: 'center' }}>
        <div style={{
            fontSize: 'clamp(2rem, 4vw, 2.5rem)',
            fontWeight: '800',
            color: 'var(--color-primary)',
            marginBottom: '0.25rem'
        }}>
            {stats.reviewCount}+
        </div>
        <div style={{
            fontSize: '0.875rem',
            color: 'var(--color-text-secondary)',
            fontWeight: '500'
        }}>
            Reviews
        </div>
    </div>

    <div style={{ textAlign: 'center' }}>
        <div style={{
            fontSize: 'clamp(2rem, 4vw, 2.5rem)',
            fontWeight: '800',
            color: 'var(--color-primary)',
            marginBottom: '0.25rem',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            gap: '0.25rem'
        }}>
            {stats.averageRating}
            <span style={{ fontSize: '1.5rem' }}>â˜…</span>
        </div>
        <div style={{
            fontSize: '0.875rem',
            color: 'var(--color-text-secondary)',
            fontWeight: '500'
        }}>
            Rating
        </div>
    </div>
</motion.div>
            </section >

    {/* Course Carousel Section */ }
{
    viewport = {{ once: true, margin: "-100px" }
}
transition = {{ duration: 0.7, ease: "easeOut" }}
style = {{ textAlign: 'center', marginBottom: '3rem' }}
                >
    <h2 style={{
        fontSize: 'clamp(2rem, 4vw, 2.5rem)',
        fontWeight: '700',
        style={{ position: 'relative', overflow: 'hidden' }}
onMouseDown = { handleDragStart }
onMouseMove = { handleDragMove }
onMouseUp = { handleDragEnd }
onMouseLeave = { handleDragEnd }
onTouchStart = { handleDragStart }
onTouchMove = { handleDragMove }
onTouchEnd = { handleDragEnd }
    >
    {/* Course Cards Grid */ }
    < div style = {{
    display: 'grid',
        gridTemplateColumns: 'repeat(3, 1fr)',
            gap: '1.5rem',
                transition: isDragging ? 'none' : 'transform 0.5s ease-in-out',
                    transform: `translateX(-${currentCourseIndex * (100 / 3)}%)`,
                        cursor: isDragging ? 'grabbing' : 'grab',
                            userSelect: 'none'
}}>
{
    courses.map((course, index) => (
        <motion.div
            key={course.id}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: index * 0.1 }}
            style={{ minWidth: '100%' }}
        >
            <Card className="card-hover" style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
                {course.imageUrl && (
                    <div style={{
                        width: '100%',
                        height: '180px',
                        borderRadius: 'var(--radius-md)',
                        overflow: 'hidden',
                        marginBottom: '1rem'
                    }}>
                        <img
                            src={course.imageUrl}
                            alt={course.title}
                            style={{
                                width: '100%',
                                height: '100%',
                                objectFit: 'cover'
                            }}
                        />
                    </div>
                )}
                <div style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>
                    <h3 style={{
                        fontSize: '1.25rem',
                        fontWeight: '700',
                        color: 'var(--color-text)',
                        marginBottom: '0.75rem',
                        lineHeight: '1.3'
                    }}>
                        {course.title}
                    </h3>
                    <p style={{
                        fontSize: '0.9375rem',
                        color: 'var(--color-text-secondary)',
                        lineHeight: '1.6',
                        marginBottom: '1rem',
                        flex: 1,
                        display: '-webkit-box',
                        WebkitLineClamp: 3,
                        WebkitBoxOrient: 'vertical',
                        overflow: 'hidden'
                    }}>
                        {course.description}
                    </p>
                    <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between',
                        gap: '1rem',
                        paddingTop: '1rem',
                        borderTop: '1px solid var(--color-border)'
                    }}>
                        <div style={{
                            fontSize: '1.25rem',
                            fontWeight: '700',
                            color: 'var(--color-primary)'
                        }}>
                            {course.fee} PKR
                        </div>
                        <Link to={`/courses/${course.id}`}>
                            <Button variant="primary" style={{ fontSize: '0.875rem', padding: '0.5rem 1rem' }}>
                                View
                            </Button>
                        </Link>
                    </div>
                </div>
            </Card>
        </motion.div>
    ))
}
        </div >

    {/* Navigation Buttons */ }
{
    courses.length > 1 && (
        <>
            <button
                onClick={prevCourse}
                style={{
                    position: 'absolute',
                    left: '-60px',
                    top: '50%',
                    transform: 'translateY(-50%)',
                    width: '48px',
                    height: '48px',
                    borderRadius: '50%',
                    backgroundColor: 'var(--color-bg-secondary)',
                    border: '1px solid var(--color-border)',
                    color: 'var(--color-text)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    cursor: 'pointer',
                    transition: 'all 0.3s'
                }}
                onMouseEnter={(e) => {
                    e.currentTarget.style.backgroundColor = 'var(--color-primary)';
                    e.currentTarget.style.color = 'white';
                }}
                onMouseLeave={(e) => {
                    e.currentTarget.style.backgroundColor = 'var(--color-bg-secondary)';
                    e.currentTarget.style.color = 'var(--color-text)';
                }}
            >
                <ChevronLeft size={24} />
            </button>
            <button
                onClick={nextCourse}
                style={{
                    position: 'absolute',
                    right: '-60px',
                    top: '50%',
                    transform: 'translateY(-50%)',
                    width: '48px',
                    height: '48px',
                    borderRadius: '50%',
                    backgroundColor: 'var(--color-bg-secondary)',
                    border: '1px solid var(--color-border)',
                    color: 'var(--color-text)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    cursor: 'pointer',
                    transition: 'all 0.3s'
                }}
                onMouseEnter={(e) => {
                    e.currentTarget.style.backgroundColor = 'var(--color-primary)';
                    e.currentTarget.style.color = 'white';
                }}
                onMouseLeave={(e) => {
                    e.currentTarget.style.backgroundColor = 'var(--color-bg-secondary)';
                    e.currentTarget.style.color = 'var(--color-text)';
                }}
            >
                <ChevronRight size={24} />
            </button>
        </>
    )
}

{/* Dots Indicator */ }
{
    courses.length > 3 && (
        <div style={{
            display: 'flex',
            justifyContent: 'center',
            gap: '0.5rem',
            marginTop: '2rem'
        }}>
            {Array.from({ length: courses.length - 2 }).map((_, index) => (
                <button
                    key={index}
                    onClick={() => setCurrentCourseIndex(index)}
                    style={{
                        width: index === currentCourseIndex ? '32px' : '8px',
                        height: '8px',
                        borderRadius: '4px',
                        backgroundColor: index === currentCourseIndex ? 'var(--color-primary)' : 'var(--color-border)',
                        border: 'none',
                        cursor: 'pointer',
                        transition: 'all 0.3s'
                    }}
                />
            ))}
        </div>
    )
}
    </div >

    {/* View All Courses Button */ }
    < motion.div
initial = {{ opacity: 0, y: 20 }}
whileInView = {{ opacity: 1, y: 0 }}
viewport = {{ once: true }}
transition = {{ duration: 0.6, delay: 0.3 }}
style = {{
    display: 'flex',
        justifyContent: 'center',
            marginTop: '3rem'
}}
>
    <Link to="/courses">
        <Button
            variant="outline"
            style={{
                padding: '0.875rem 2.5rem',
                fontSize: '1rem',
                fontWeight: '600'
            }}
        >
            View All Courses
        </Button>
    </Link>
</motion.div >
            </div >
        </motion.section >
    )
}


{/* Meet Your Instructors Section */ }
{
    viewport = {{ once: true, margin: "-100px" }
}
transition = {{ duration: 0.7, ease: "easeOut" }}
style = {{ textAlign: 'center', marginBottom: '3rem' }}
                >
                    <h2 style={{
                        fontSize: 'clamp(2rem, 4vw, 2.5rem)',
                        fontWeight: '700',
                        color: 'var(--color-text)',
                        marginBottom: '1rem'
                    }}>
                        Meet Your Instructor{instructors.length > 1 ? 's' : ''}
                    </h2>
                    <p style={{
                        fontSize: '1rem',
                        color: 'var(--color-text-secondary)',
                        maxWidth: '700px',
                        margin: '0 auto'
                    }}>
                        Learn from experienced developers passionate about teaching
                    </p>
                </motion.div >

    <div style={{
        display: 'grid',
        gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))',
        gap: '2rem',
        maxWidth: instructors.length === 1 ? '500px' : '100%',
        margin: '0 auto'
    }}>
        {instructors.map((instructor, index) => (
            <motion.div
                key={instructor.id}
                initial={{ opacity: 0, y: 20 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
            >
                <Card className="card-hover" style={{
                    height: '100%',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    textAlign: 'center',
                    padding: '2rem'
                }}>
                    {/* Profile Image */}
                    {instructor.imageUrl ? (
                        <img
                            src={instructor.imageUrl}
                            alt={instructor.name}
                            style={{
                                width: '120px',
                                height: '120px',
                                borderRadius: '50%',
                                objectFit: 'cover',
                                border: '4px solid var(--color-primary)',
                                marginBottom: '1.5rem'
                            }}
                        />
                    ) : (
                        <div style={{
                            width: '120px',
                            height: '120px',
                            borderRadius: '50%',
                            backgroundColor: 'var(--color-bg-secondary)',
                            border: '4px solid var(--color-primary)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            marginBottom: '1.5rem'
                        }}>
                            <UserCircle size={60} style={{ color: 'var(--color-text-secondary)' }} />
                        </div>
                    )}

                    {/* Name */}
                    <h3 style={{
                        fontSize: '1.5rem',
                        fontWeight: '700',
                        color: 'var(--color-text)',
                        marginBottom: '0.5rem'
                    }}>
                        {instructor.name}
                    </h3>

                    {/* Brief */}
                    <p style={{
                        fontSize: '1rem',
                        color: 'var(--color-text-secondary)',
                        marginBottom: '1.5rem',
                        lineHeight: '1.6'
                    }}>
                        {instructor.brief}
                    </p>

                    {/* Skills */}
                    {instructor.skills && instructor.skills.length > 0 && (
                        <div style={{
                            display: 'flex',
                            gap: '0.5rem',
                            flexWrap: 'wrap',
                            justifyContent: 'center'
                        }}>
                            {instructor.skills.map((skill, skillIndex) => (
                                <span
                                    key={skillIndex}
                                    style={{
                                        padding: '0.375rem 0.875rem',
                                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                        border: '1px solid rgba(59, 130, 246, 0.3)',
                                        borderRadius: 'var(--radius-sm)',
                                        fontSize: '0.8125rem',
                                        fontWeight: '600',
                                        color: 'var(--color-primary)'
                                    }}
                                >
                                    {skill}
                                </span>
                            ))}
                        </div>
                    )}
                </Card>
            </motion.div>
        ))}
    </div>
            </div >
        </motion.section >
    )
}

{/* Features Section */ }
{/* Why Choose ZXSchool Section */ }
<motion.section
    initial={{ opacity: 0 }}
    whileInView={{ opacity: 1 }}
    viewport={{ once: true, margin: "-150px" }}
    transition={{ duration: 0.8 }}
    style={{
        padding: '5rem 0',
        backgroundColor: 'var(--color-bg-secondary)',
        position: 'relative',
        overflow: 'hidden'
    }}
>
    {/* Background Gradient */}
    <div style={{
        position: 'absolute',
        top: 0,
        left: '50%',
        transform: 'translateX(-50%)',
        width: '100%',
        height: '100%',
        background: 'radial-gradient(circle at 50% 0%, rgba(59, 130, 246, 0.05) 0%, transparent 70%)',
        pointerEvents: 'none'
    }} />

    <div className="container" style={{ position: 'relative', zIndex: 1 }}>
        <motion.div
            initial={{ opacity: 0, y: 30 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true, margin: "-100px" }}
            transition={{ duration: 0.7, ease: "easeOut" }}
            style={{ textAlign: 'center', marginBottom: '4rem' }}
        >
            <h2 style={{
                fontSize: 'clamp(2rem, 4vw, 2.5rem)',
                fontWeight: '700',
                color: 'var(--color-text)',
                marginBottom: '1rem'
            }}>
                Why Choose ZXSchool?
            </h2>
            <p style={{
                fontSize: '1.125rem',
                color: 'var(--color-text-secondary)',
                maxWidth: '700px',
                margin: '0 auto',
                lineHeight: '1.8'
            }}>
                Join thousands of students who have transformed their programming skills with our proven approach
            </p>
        </motion.div>

        <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fit, minmax(320px, 1fr))',
            gap: '2rem'
        }}>
            {[
                {
                    icon: GraduationCap,
                    title: 'Expert Instructors',
                    description: 'Learn from experienced developers who understand real-world challenges and teach practical solutions.',
                    color: '#3b82f6',
                    delay: 0.1
                },
                {
                    icon: Target,
                    title: 'Concept Mastery',
                    description: 'Fill the gaps from university education with clear explanations of fundamental programming concepts.',
                    color: '#8b5cf6',
                    delay: 0.2
                },
                {
                    icon: Code,
                    title: 'Hands-On Projects',
                    description: 'Build real applications and strengthen your portfolio with practical, industry-relevant projects.',
                    color: '#06b6d4',
                    delay: 0.3
                },
                {
                    icon: Award,
                    title: 'Career Ready',
                    description: 'Develop the skills and confidence needed to excel in technical interviews and professional roles.',
                    color: '#10b981',
                    delay: 0.4
                },
                {
                    icon: Users,
                    title: 'Supportive Community',
                    description: 'Join a network of learners and get help when you need it through our active community.',
                    color: '#f59e0b',
                    delay: 0.5
                },
                {
                    icon: Briefcase,
                    title: 'Flexible Learning',
                    description: 'Study at your own pace with lifetime access to course materials and regular content updates.',
                    color: '#ec4899',
                    delay: 0.6
                }
            ].map((feature, index) => {
                const Icon = feature.icon;
                return (
                    <motion.div
                        key={index}
                        initial={{ opacity: 0, y: 20 }}
                        whileInView={{ opacity: 1, y: 0 }}
                        viewport={{ once: true }}
                        transition={{ duration: 0.5, delay: feature.delay }}
                    >
                        <Card className="card-hover" style={{
                            height: '100%',
                            padding: '2rem',
                            position: 'relative',
                            overflow: 'hidden'
                        }}>
                            {/* Accent Line */}
                            <div style={{
                                position: 'absolute',
                                top: 0,
                                left: 0,
                                width: '4px',
                                height: '100%',
                                background: `linear-gradient(to bottom, ${feature.color}, transparent)`,
                                opacity: 0.8
                            }} />

                            {/* Icon */}
                            <div style={{
                                width: '64px',
                                height: '64px',
                                borderRadius: 'var(--radius-lg)',
                                background: `linear-gradient(135deg, ${feature.color}15, ${feature.color}05)`,
                                border: `1px solid ${feature.color}30`,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                marginBottom: '1.5rem'
                            }}>
                                <Icon size={32} style={{ color: feature.color }} />
                            </div>

                            {/* Content */}
                            <h3 style={{
                                fontSize: '1.25rem',
                                fontWeight: '600',
                                color: 'var(--color-text)',
                                marginBottom: '0.75rem'
                            }}>
                                {feature.title}
                            </h3>
                            <p style={{
                                fontSize: '0.9375rem',
                                color: 'var(--color-text-secondary)',
                                lineHeight: '1.7',
                                margin: 0
                            }}>
                                {feature.description}
                            </p>
                        </Card>
                    </motion.div>
                );
            })}
        </div>
    </div>
</motion.section>

{/* Footer */ }
<footer style={{
    backgroundColor: 'var(--color-bg-secondary)',
    padding: '2rem 0',
    marginTop: '4rem',
    textAlign: 'center',
    borderTop: '1px solid var(--color-border)'
}}>
    <div className="container">
        <p style={{ color: 'var(--color-text-secondary)' }}>
            &copy; 2025 ZXSchool. All rights reserved.
        </p>
    </div>
</footer>
        </div >
    );
};

export default LandingPage;
